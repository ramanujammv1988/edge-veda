---
phase: 03-demo-app-polish
plan: 04
type: execute
wave: 3
depends_on: [03-03]
files_modified:
  - flutter/example/README.md
autonomous: true

must_haves:
  truths:
    - "Developer can read README and set up example app in <30 minutes"
    - "README includes performance expectations from BENCHMARK.md"
    - "README documents iOS backgrounding behavior (App Store requirement)"
    - "README includes troubleshooting common issues"
  artifacts:
    - path: "flutter/example/README.md"
      provides: "Complete setup instructions, usage guide, performance docs"
      min_lines: 150
      contains: "Prerequisites"
  key_links:
    - from: "README Setup section"
      to: "flutter pub get, flutter run commands"
      via: "step-by-step instructions"
      pattern: "flutter pub get|flutter run"
    - from: "README Performance section"
      to: "BENCHMARK.md results"
      via: "reference to benchmark metrics"
      pattern: "BENCHMARK\\.md"
---

<objective>
Write comprehensive README documentation for example app with setup, usage, and performance guidance.

Purpose: Developers need clear instructions to run the example app and understand SDK capabilities. README must document performance expectations (from benchmarks), iOS backgrounding behavior (App Store requirement), and troubleshooting for common issues.

Output: Professional README that enables developers to run example app successfully and understand SDK behavior.
</objective>

<execution_context>
@/Users/ram/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ram/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-demo-app-polish/03-RESEARCH.md
@flutter/example/BENCHMARK.md
@flutter/lib/edge_veda.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write comprehensive README.md for example app</name>
  <files>flutter/example/README.md</files>
  <action>
Create a professional README with all information developers need to run and understand the example app.

README.md structure:

```markdown
# Edge Veda Example App

A demonstration Flutter app showcasing the Edge Veda SDK for on-device LLM inference on iOS.

## Features

- ðŸš€ **Fast On-Device Inference** - Llama 3.2 1B model running locally with Metal GPU acceleration
- ðŸ“Š **Real-Time Metrics** - Live display of tokens/sec, TTFT, and memory usage
- ðŸ’¬ **Chat Interface** - Simple conversational UI for testing prompts
- ðŸ“¥ **Automatic Model Download** - First-run download with progress tracking
- ðŸ”‹ **Lifecycle Handling** - Proper iOS backgrounding behavior (App Store compliant)
- ðŸ“ˆ **Benchmark Mode** - Performance testing with 10+ consecutive generations

## Prerequisites

### Required

- **macOS** (for iOS development)
- **Xcode 14.0+** with Command Line Tools
- **Flutter 3.16.0+** (stable channel recommended)
- **iOS 15.0+ device** (iPhone 12 or newer recommended)

### Build Dependencies

The Edge Veda SDK requires native C++ libraries. Before running the example app, you must build the iOS XCFramework:

```bash
# From project root
./scripts/build-ios.sh --clean --release
```

This builds `EdgeVedaCore.xcframework` with llama.cpp and the C++ inference engine.

> **Note:** Xcode installation is required for iOS builds. Command Line Tools alone are insufficient.

### Storage Requirements

- **Initial app size:** ~15-20 MB
- **Model download:** ~650 MB (Llama 3.2 1B Q4_K_M)
- **Runtime memory:** 600-1000 MB during inference
- **Total storage needed:** ~1 GB

## Getting Started

### 1. Clone and Setup

```bash
# Clone the repository
git clone <repository-url>
cd edge/flutter/example

# Install Flutter dependencies
flutter pub get
```

### 2. Build Native Libraries

```bash
# Build iOS XCFramework (from project root)
cd ../..
./scripts/build-ios.sh --clean --release
```

Verify the build succeeded:
```bash
ls flutter/ios/Frameworks/EdgeVedaCore.xcframework/ios-arm64/libedge_veda_full.a
# Should show the static library file
```

### 3. Connect iOS Device

The example app requires a **real iOS device** (iPhone 12+ recommended). The iOS Simulator uses Mac's GPU and gives misleading performance results.

```bash
# List connected devices
flutter devices

# Example output:
# iPhone 12 (mobile) â€¢ 00008030-XXXXX â€¢ ios â€¢ iOS 15.0
```

### 4. Run the App

```bash
# Run in release mode for accurate performance
flutter run --release -d <device-id>

# Or simply (if only one device connected)
flutter run --release
```

### 5. First Launch

On first launch, the app will:

1. **Download the model** (~650 MB) - Takes 2-5 minutes on WiFi
   - Progress bar shows download percentage
   - Model caches in app support directory

2. **Prompt for initialization** - Tap "Initialize" button
   - Loads model into memory (~600 MB)
   - Tests inference with Metal GPU
   - Shows "Ready to chat!" when complete

3. **Ready to use** - Type a prompt and tap send

> **Tip:** Keep device plugged in during first run. Model download and initial load are resource-intensive.

## Using the Example App

### Chat Interface

1. **Type a prompt** in the text field at the bottom
2. **Tap send icon** to generate a response
3. **View response** in the chat bubble
4. **Monitor metrics** in the top bar:
   - **TTFT:** Time to First Token (latency)
   - **Speed:** Tokens per second
   - **Memory:** Current memory usage

### Performance Metrics

The metrics bar updates after each generation:

- **TTFT (Time to First Token):** How quickly the model starts generating (lower is better)
- **Speed (tok/s):** Generation throughput (higher is better)
- **Memory (MB):** Current memory usage (should stay <1200 MB)

**Target Performance:**
- Speed: >15 tok/s on iPhone 12
- Memory: <1200 MB peak usage

See [BENCHMARK.md](./BENCHMARK.md) for detailed performance results on iPhone 12.

### Info Dialog

Tap the **info icon** (â“˜) in the AppBar to see:
- Current memory usage and percentage
- Memory pressure status (warning if high)
- Last generation performance metrics

### Benchmark Mode

Tap the **assessment icon** (ðŸ“Š) to run a 10-test benchmark:

1. Runs 10 consecutive generations with varied prompts
2. Measures avg tok/s, TTFT, and peak memory
3. Shows results in dialog and logs to console
4. Takes ~2-3 minutes to complete

Results help validate SDK performance on your specific device and iOS version.

## iOS Backgrounding Behavior

**Important:** The example app cancels generation when you background the app (press home button or switch apps).

### Why?

iOS requires apps to stop CPU-intensive tasks when backgrounded. Running inference in the background causes:
- App Store rejection
- System termination (jetsam kills)
- Poor user experience (battery drain)

### What Happens?

- **You send a prompt** â†’ Generation starts
- **You press home** â†’ Generation immediately cancels
- **Status bar shows** "Generation cancelled - app backgrounded"
- **You return to app** â†’ Send a new prompt to continue

This is expected behavior and required for App Store approval.

## Troubleshooting

### Model Download Issues

**Problem:** Download fails or stalls

**Solutions:**
- Ensure stable WiFi connection
- Check available storage (need 1 GB free)
- Restart app to retry download
- Check console for error messages

### Memory Warnings

**Problem:** "High memory pressure" warning appears

**Solutions:**
- Close other apps to free memory
- Restart the device
- Note: 1 GB usage is normal during inference
- Memory should stabilize after a few generations

### Initialization Fails

**Problem:** "Initialization failed" error

**Solutions:**
1. Verify XCFramework is built:
   ```bash
   ls ../ios/Frameworks/EdgeVedaCore.xcframework/ios-arm64/libedge_veda_full.a
   ```
2. Rebuild if missing:
   ```bash
   cd ../../.. && ./scripts/build-ios.sh --clean --release
   ```
3. Clean and rebuild app:
   ```bash
   flutter clean && flutter pub get && flutter run --release
   ```

### Slow Performance

**Problem:** Speed <15 tok/s on iPhone 12

**Possible Causes:**
- **Thermal throttling:** Device is hot, CPU/GPU throttled for cooling
- **Low power mode:** iOS reduces performance to save battery
- **Background apps:** Other apps consuming resources
- **Debug mode:** Run with `--release` flag, not debug

**Solutions:**
- Let device cool down
- Disable Low Power Mode (Settings > Battery)
- Close background apps
- Ensure running in release mode

### "setState() after dispose()" Errors

**Problem:** Hot reload causes crash with lifecycle errors

**Solutions:**
- This is expected with hot reload and FFI
- **Hot restart** instead of hot reload: Press 'R' in terminal
- Full rebuild: `flutter run --release` again

## Performance Expectations

Based on benchmarks from iPhone 12 (see [BENCHMARK.md](./BENCHMARK.md)):

| Metric | iPhone 12 | Target | Notes |
|--------|-----------|--------|-------|
| Avg Speed | [VALUE from BENCHMARK.md] tok/s | >15 tok/s | Varies by prompt |
| TTFT | [VALUE] ms | <500 ms | Prompt processing |
| Peak Memory | [VALUE] MB | <1200 MB | Stable across runs |

**Device Variations:**
- **iPhone 13+:** Expect 20-30% faster (better GPU)
- **iPhone 11/SE:** Expect 20-30% slower (older GPU)
- **iPad:** Similar to comparable iPhone generation

**Thermal Throttling:**
After 5+ minutes of continuous inference, performance may drop 10-30% as device heats up. This is normal iOS behavior.

## Project Structure

```
lib/
â”œâ”€â”€ main.dart           # App entry point and ChatScreen
â””â”€â”€ [Other files TBD in Phase 4]

BENCHMARK.md           # Performance benchmark results
README.md              # This file
pubspec.yaml           # Dependencies (references ../pubspec.yaml)
```

## SDK Usage Reference

The example app demonstrates core SDK functionality:

```dart
import 'package:edge_veda/edge_veda.dart';

// Initialize SDK
final edgeVeda = EdgeVeda();
final modelManager = ModelManager();

// Download model (with progress tracking)
final modelPath = await modelManager.downloadModel(ModelRegistry.llama32_1b);

// Initialize inference engine
await edgeVeda.init(EdgeVedaConfig(
  modelPath: modelPath,
  useGpu: true,
  numThreads: 4,
  contextLength: 2048,
));

// Generate text
final response = await edgeVeda.generate(
  'Your prompt here',
  options: GenerateOptions(
    maxTokens: 256,
    temperature: 0.7,
  ),
);

print(response.text);

// Monitor memory
final stats = await edgeVeda.getMemoryStats();
print('Memory: ${stats.currentBytes / (1024 * 1024)} MB');

// Cleanup
edgeVeda.dispose();
```

See the [main SDK README](../../README.md) for full API documentation.

## Known Limitations (v1)

- **No streaming:** v1 uses synchronous generation. Streaming support planned for v2.
- **Foreground only:** Generation must run while app is visible (iOS requirement).
- **Single concurrent generation:** Starting a new generation cancels the previous one.
- **Fixed model:** v1 includes only Llama 3.2 1B Q4_K_M. More models in v2.

## Contributing

This is an example app demonstrating SDK capabilities. For SDK issues or feature requests, please file issues in the main repository.

## License

See [LICENSE](../../LICENSE) file in the repository root.

---

**SDK Version:** 1.0.0
**Flutter Version:** 3.16.0+
**iOS Version:** 15.0+
**Last Updated:** 2026-02-04
```

**Implementation instructions:**

1. Create flutter/example/README.md with the template above
2. Replace `[VALUE from BENCHMARK.md]` placeholders with actual benchmark results from 03-03-PLAN.md
3. Replace `<repository-url>` with actual repo URL (or leave as placeholder if repo not public yet)
4. Ensure all code examples compile (they're taken from actual SDK usage)
5. Update "Last Updated" date to current date (2026-02-04)

**Why this structure:**
- **Quick start first:** Developers want to run the app immediately
- **Troubleshooting prominent:** Common issues documented upfront
- **Performance expectations clear:** Benchmark results set realistic expectations
- **iOS backgrounding documented:** Critical App Store requirement explained
- **SDK usage reference:** Shows how to use SDK in own apps
  </action>
  <verify>
1. File exists: `ls flutter/example/README.md`
2. File is comprehensive: `wc -l flutter/example/README.md` (expect 300+ lines)
3. Contains setup instructions: `grep -i "getting started\|prerequisites" flutter/example/README.md`
4. Contains performance section: `grep -i "performance\|benchmark" flutter/example/README.md`
5. Contains troubleshooting: `grep -i "troubleshooting" flutter/example/README.md`
6. References BENCHMARK.md: `grep "BENCHMARK.md" flutter/example/README.md`
7. Documents backgrounding: `grep -i "background\|app store" flutter/example/README.md`
8. No placeholder brackets: `grep -c "\[VALUE from BENCHMARK\]" flutter/example/README.md` returns 0 (or small number if multiple)
  </verify>
  <done>
README.md exists with comprehensive setup instructions, usage guide, performance expectations, troubleshooting, and iOS backgrounding documentation.
  </done>
</task>

</tasks>

<verification>
After completion:
```bash
# Verify README exists and is comprehensive
cd flutter/example
wc -l README.md
# Expect: 300+ lines

# Check for key sections
grep -n "## Prerequisites" README.md
grep -n "## Getting Started" README.md
grep -n "## Troubleshooting" README.md
grep -n "## Performance Expectations" README.md
grep -n "iOS Backgrounding" README.md

# Verify references to BENCHMARK.md
grep -c "BENCHMARK.md" README.md
# Expect: 3+ references

# Check for no remaining placeholders
grep "\[VALUE from BENCHMARK" README.md
# Expect: Empty or only in table (will be filled from 03-03)
```
</verification>

<success_criteria>
1. README.md exists with 300+ lines of documentation
2. Contains setup instructions (prerequisites, getting started, build steps)
3. Contains usage guide (chat interface, metrics, benchmark mode)
4. Documents performance expectations with reference to BENCHMARK.md
5. Explains iOS backgrounding behavior (App Store requirement)
6. Includes troubleshooting section for common issues
7. Professional formatting with clear sections and code examples
</success_criteria>

<output>
After completion, create `.planning/phases/03-demo-app-polish/03-04-SUMMARY.md`
</output>
