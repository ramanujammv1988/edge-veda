---
phase: 04-release
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - flutter/ios/edge_veda.podspec
  - scripts/prepare-release.sh
  - flutter/CHANGELOG.md
autonomous: true

must_haves:
  truths:
    - "Podspec version matches pubspec version (1.0.0)"
    - "Podspec HTTP source comment documents XCFramework distribution approach"
    - "Version sync script validates consistency across pubspec, podspec, changelog"
    - "Dry-run publish succeeds without size limit errors"
    - "Changelog has release date finalized for 1.0.0"
  artifacts:
    - path: "flutter/ios/edge_veda.podspec"
      provides: "Updated podspec with correct version and distribution docs"
      min_lines: 90
    - path: "scripts/prepare-release.sh"
      provides: "Version synchronization and validation script"
      min_lines: 60
      exports: ["executable script"]
    - path: "flutter/CHANGELOG.md"
      provides: "Finalized changelog with release date"
      contains: "[1.0.0] - 2026-02-04"
  key_links:
    - from: "scripts/prepare-release.sh"
      to: "flutter/pubspec.yaml"
      via: "grep version extraction"
      pattern: 'grep.*version.*pubspec\.yaml'
    - from: "scripts/prepare-release.sh"
      to: "flutter/ios/edge_veda.podspec"
      via: "grep version extraction"
      pattern: 'grep.*s\.version.*podspec'
---

<objective>
Synchronize package metadata and prepare for pub.dev publishing by fixing version mismatches and documenting the XCFramework distribution strategy.

Purpose: Ensure consistency between pubspec.yaml (1.0.0) and podspec (currently 0.1.0), create validation tooling to prevent future version drift, and document the HTTP source approach for XCFramework distribution. This unblocks the release workflow by ensuring all version-sensitive files are in sync.

Output: Updated podspec at correct version with distribution documentation, executable prepare-release.sh script that validates version consistency, finalized CHANGELOG.md with release date, and successful dry-run publish verification.
</objective>

<execution_context>
@/Users/ram/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ram/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/ram/Documents/explore/edge/.planning/PROJECT.md
@/Users/ram/Documents/explore/edge/.planning/ROADMAP.md
@/Users/ram/Documents/explore/edge/.planning/STATE.md
@/Users/ram/Documents/explore/edge/.planning/phases/04-release/04-RESEARCH.md

# Existing files that need updates
@/Users/ram/Documents/explore/edge/flutter/pubspec.yaml
@/Users/ram/Documents/explore/edge/flutter/ios/edge_veda.podspec
@/Users/ram/Documents/explore/edge/flutter/CHANGELOG.md
</context>

<tasks>

<task type="auto">
  <name>Update podspec version and add HTTP source documentation</name>
  <files>flutter/ios/edge_veda.podspec</files>
  <action>
Update the podspec to version 1.0.0 and add documentation explaining the XCFramework distribution approach.

Changes required:
1. Update `s.version = '0.1.0'` to `s.version = '1.0.0'` (line 6)
2. Add comment block BEFORE the `s.preserve_paths` line (around line 39) explaining XCFramework distribution:

```ruby
  # XCFramework Distribution Strategy
  # The EdgeVedaCore.xcframework (~20MB with llama.cpp) exceeds pub.dev's 100MB package limit.
  # For v1.0.0, we use CocoaPods HTTP source approach:
  #   1. XCFramework hosted on GitHub Releases
  #   2. Users download via: curl -L https://github.com/edgeveda/edge-veda-sdk/releases/download/v1.0.0/EdgeVedaCore-ios.xcframework.zip
  #   3. Extract to flutter/ios/Frameworks/ before pod install
  #   4. OR run: ./scripts/build-ios.sh --clean --release
  # Future: Migrate to Dart Native Assets (hook/build.dart) for automatic download in v1.1.0
  s.preserve_paths = 'Frameworks/EdgeVedaCore.xcframework'
```

3. Verify all other version references are consistent (description, source tag reference)

This documents the manual download requirement until we migrate to Dart Native Assets in v1.1.0.
  </action>
  <verify>
grep "s.version.*=.*'1.0.0'" /Users/ram/Documents/explore/edge/flutter/ios/edge_veda.podspec
grep "XCFramework Distribution Strategy" /Users/ram/Documents/explore/edge/flutter/ios/edge_veda.podspec
  </verify>
  <done>Podspec version is 1.0.0, HTTP source documentation comment exists before preserve_paths, no version mismatches remain</done>
</task>

<task type="auto">
  <name>Create prepare-release.sh validation script</name>
  <files>scripts/prepare-release.sh</files>
  <action>
Create a bash script that validates version consistency and prepares for release.

Script requirements:
1. Accept version argument: `./scripts/prepare-release.sh 1.0.0`
2. Validate version format (semver: X.Y.Z)
3. Extract current versions from:
   - flutter/pubspec.yaml (line 3: `version: 1.0.0`)
   - flutter/ios/edge_veda.podspec (line 6: `s.version = '1.0.0'`)
   - flutter/CHANGELOG.md (look for `## [X.Y.Z]` entry)
4. Compare all three versions - exit 1 if any mismatch
5. Run `cd flutter && flutter pub get && dart pub publish --dry-run`
6. Check for warnings about package size (should be under 10MB without XCFramework)
7. Print summary:
   - Versions: ✓ or ✗
   - Dry-run: ✓ or ✗
   - Package size: X MB (limit: 100MB)
   - Next steps: "Ready to release v$VERSION" or error messages

Include usage help with --help flag.

Make executable: chmod +x scripts/prepare-release.sh

Reference the research document's example script structure but simplify - don't modify files, just validate.
  </action>
  <verify>
chmod +x /Users/ram/Documents/explore/edge/scripts/prepare-release.sh
/Users/ram/Documents/explore/edge/scripts/prepare-release.sh --help
/Users/ram/Documents/explore/edge/scripts/prepare-release.sh 1.0.0 | grep -E "Versions:.*✓|Ready to release"
  </verify>
  <done>Script exists, is executable, validates version consistency across all three files, runs dry-run publish, exits 0 on success</done>
</task>

<task type="auto">
  <name>Finalize CHANGELOG.md release date</name>
  <files>flutter/CHANGELOG.md</files>
  <action>
Update the CHANGELOG.md to finalize the 1.0.0 release entry.

Changes required:
1. Change line 8 from `## [0.1.0] - 2026-02-04` to `## [1.0.0] - 2026-02-04`
2. Update the version in the bottom reference link from `[0.1.0]` to `[1.0.0]` if present
3. Add a new entry at the top for future work:

```markdown
## [Unreleased]

(keep existing Planned section as-is)

## [1.0.0] - 2026-02-04
(existing content)
```

This follows Keep a Changelog format with Unreleased section for ongoing work and timestamped release.
  </action>
  <verify>
grep "## \[1.0.0\] - 2026-02-04" /Users/ram/Documents/explore/edge/flutter/CHANGELOG.md
grep "## \[Unreleased\]" /Users/ram/Documents/explore/edge/flutter/CHANGELOG.md
  </verify>
  <done>CHANGELOG.md has [1.0.0] release dated 2026-02-04, [Unreleased] section exists at top for future work</done>
</task>

<task type="auto">
  <name>Run dry-run validation and verify package size</name>
  <files></files>
  <action>
Execute the prepare-release.sh script to validate all version synchronization and run pub.dev dry-run checks.

Commands:
1. cd /Users/ram/Documents/explore/edge
2. ./scripts/prepare-release.sh 1.0.0
3. Verify output shows:
   - Versions: ✓ (all three files match)
   - Dry-run: ✓ (no blocking errors)
   - Package size: Under 10MB (XCFramework not included)

Expected warnings (acceptable):
- "Package has 0 issues" or low issue count
- May warn about missing XCFramework (expected - it's hosted externally)

Blocking errors (must fix if occur):
- Version mismatch between files
- Package size exceeds 100MB (indicates XCFramework accidentally included)
- Missing required files (LICENSE, README.md, pubspec.yaml)
- Validation errors in pubspec.yaml

If errors occur, diagnose and fix before marking complete. The most likely issue is pub.dev complaining about missing example app dependencies - this is acceptable for now as example app is in flutter/example/.
  </action>
  <verify>
cd /Users/ram/Documents/explore/edge && ./scripts/prepare-release.sh 1.0.0 2>&1 | tee /tmp/release-validation.log
grep -q "Ready to release\|Versions:.*✓" /tmp/release-validation.log
  </verify>
  <done>prepare-release.sh exits 0, all versions validated as 1.0.0, dry-run publish succeeds, package size under 10MB</done>
</task>

</tasks>

<verification>
Manual verification checklist:
1. Podspec version is 1.0.0: `grep "s.version" flutter/ios/edge_veda.podspec`
2. Pubspec version is 1.0.0: `grep "version:" flutter/pubspec.yaml`
3. CHANGELOG version is 1.0.0: `grep "\[1.0.0\]" flutter/CHANGELOG.md`
4. Prepare script validates: `./scripts/prepare-release.sh 1.0.0`
5. Dry-run succeeds: Output shows "Package validation found no issues" or similar

All checks must pass before proceeding to Phase 04-02 (Release Workflow).
</verification>

<success_criteria>
- [ ] flutter/ios/edge_veda.podspec version field is '1.0.0'
- [ ] Podspec includes XCFramework distribution comment before preserve_paths
- [ ] flutter/CHANGELOG.md has [1.0.0] entry dated 2026-02-04
- [ ] scripts/prepare-release.sh exists and is executable (chmod +x)
- [ ] Running prepare-release.sh 1.0.0 exits with code 0
- [ ] All version checks pass (pubspec, podspec, changelog all show 1.0.0)
- [ ] dart pub publish --dry-run completes without blocking errors
- [ ] Package size reported under 10MB (XCFramework not included in package)
</success_criteria>

<output>
After completion, create `.planning/phases/04-release/04-01-SUMMARY.md` documenting:
- Version synchronization status (all files at 1.0.0)
- prepare-release.sh script location and usage
- Dry-run validation results
- Any warnings or edge cases discovered
- Readiness for 04-02 (Release Workflow creation)
</output>
