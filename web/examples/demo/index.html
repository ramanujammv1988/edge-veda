<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Veda â€” On-Device Intelligence</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Welcome Screen -->
  <div id="welcome-screen" class="screen active">
    <div class="welcome-content">
      <div class="logo-container">
        <svg width="200" height="200" viewBox="0 0 200 200" class="logo-svg">
          <defs>
            <radialGradient id="glow" cx="100" cy="100" r="120" gradientUnits="userSpaceOnUse">
              <stop offset="0" stop-color="#E50914" stop-opacity="0.15"/>
              <stop offset="1" stop-color="#E50914" stop-opacity="0"/>
            </radialGradient>
          </defs>
          <circle cx="100" cy="100" r="100" fill="url(#glow)"/>
          <path d="M 53 30 L 78 30 L 100 120 L 122 30 L 147 30 L 100 170 Z" fill="#E50914"/>
        </svg>
      </div>
      <h1 class="welcome-title">Veda</h1>
      <p class="welcome-subtitle">On-Device Intelligence</p>
      <button class="btn-primary" onclick="showMain()">Get Started</button>
      <p class="welcome-tagline">100% Private. Runs entirely in your browser.</p>
    </div>
  </div>

  <!-- Main App -->
  <div id="main-screen" class="screen">
    <!-- Tab content -->
    <div id="tab-content">
      <!-- Chat Tab -->
      <div id="tab-chat" class="tab-panel active">
        <header class="top-bar">
          <h2 class="top-title">Veda</h2>
          <div class="top-actions">
            <button class="icon-btn" onclick="resetChat()" title="New Chat">ğŸ”„</button>
            <button class="icon-btn" onclick="runBenchmark()" title="Benchmark">ğŸ“Š</button>
            <button class="icon-btn" onclick="showModelSheet()" title="Models">ğŸ“¦</button>
          </div>
        </header>

        <!-- Status bar -->
        <div class="status-bar">
          <div id="status-spinner" class="spinner hidden"></div>
          <span id="status-text" class="status-text warning">Ready to initialize</span>
          <button id="init-btn" class="btn-small" onclick="initializeEngine()">Initialize</button>
        </div>

        <!-- Metrics bar -->
        <div id="metrics-bar" class="metrics-bar hidden">
          <div class="metric-chip"><span class="metric-label">TTFT</span><span id="metric-ttft" class="metric-value">-</span></div>
          <div class="metric-chip"><span class="metric-label">Speed</span><span id="metric-speed" class="metric-value">-</span></div>
          <div class="metric-chip"><span class="metric-label">Memory</span><span id="metric-memory" class="metric-value">-</span></div>
          <div class="metric-chip"><span class="metric-label">Confidence</span><span id="metric-confidence" class="metric-value">-</span></div>
        </div>

        <!-- Persona picker -->
        <div id="persona-picker" class="persona-picker hidden">
          <span class="persona-label">Choose a persona</span>
          <div class="persona-chips">
            <button class="chip active" data-preset="assistant" onclick="changePreset('assistant')">Assistant</button>
            <button class="chip" data-preset="coder" onclick="changePreset('coder')">Coder</button>
            <button class="chip" data-preset="creative" onclick="changePreset('creative')">Creative</button>
          </div>
        </div>

        <!-- Context indicator -->
        <div id="context-indicator" class="context-indicator hidden">
          <span id="context-turns" class="context-text">0 turns</span>
          <div class="context-bar-bg"><div id="context-bar-fill" class="context-bar-fill"></div></div>
          <span id="context-pct" class="context-pct">0%</span>
        </div>

        <!-- Messages area -->
        <div id="messages" class="messages">
          <div class="empty-state">
            <div class="empty-icon">ğŸ’­</div>
            <div class="empty-title">Start a conversation</div>
            <div class="empty-sub">Ask anything. It runs in your browser.</div>
          </div>
        </div>

        <!-- Input bar -->
        <div class="input-bar">
          <textarea id="prompt-input" class="prompt-input" placeholder="Message..." rows="1" disabled></textarea>
          <button id="send-btn" class="send-btn" onclick="sendMessage()" disabled>â†‘</button>
        </div>
      </div>

      <!-- Voice Tab -->
      <div id="tab-voice" class="tab-panel">
        <header class="top-bar"><h2 class="top-title">Voice</h2></header>
        <div class="voice-container">
          <div class="voice-status-area">
            <div id="voice-pulse" class="voice-pulse"></div>
            <div id="voice-status-text" class="voice-status-text">Tap microphone to start</div>
          </div>
          <div id="voice-transcript" class="voice-transcript hidden">
            <div class="transcript-label">Transcript</div>
            <div id="transcript-text" class="transcript-text"></div>
          </div>
          <div class="voice-controls">
            <button id="voice-btn" class="voice-btn" onclick="toggleVoiceRecording()">
              <span class="voice-icon">ğŸ¤</span>
            </button>
            <div class="voice-hint">Speech-to-text with Whisper</div>
          </div>
        </div>
      </div>

      <!-- Tools Tab -->
      <div id="tab-tools" class="tab-panel">
        <header class="top-bar">
          <h2 class="top-title">Tools</h2>
          <div class="top-actions">
            <button class="icon-btn" onclick="resetToolsChat()" title="Clear">ğŸ”„</button>
          </div>
        </header>

        <!-- Tool Status -->
        <div class="status-bar">
          <span id="tools-status-text" class="status-text success">Tool calling ready</span>
        </div>

        <!-- Available Tools -->
        <div class="tools-info">
          <div class="section-subtitle">Available Tools</div>
          <div class="tool-chips">
            <div class="tool-chip">ğŸ“… get_time</div>
            <div class="tool-chip">ğŸ”¢ calculate</div>
          </div>
        </div>

        <!-- Messages area -->
        <div id="tools-messages" class="messages">
          <div class="empty-state">
            <div class="empty-icon">ğŸ”§</div>
            <div class="empty-title">Function calling demo</div>
            <div class="empty-sub">Try: "What time is it in Tokyo?" or "Calculate 42 * 137"</div>
          </div>
        </div>

        <!-- Input bar -->
        <div class="input-bar">
          <textarea id="tools-input" class="prompt-input" placeholder="Ask about time or calculations..." rows="1" disabled></textarea>
          <button id="tools-send-btn" class="send-btn" onclick="sendToolsMessage()" disabled>â†‘</button>
        </div>
      </div>

      <!-- RAG Tab -->
      <div id="tab-rag" class="tab-panel">
        <header class="top-bar">
          <h2 class="top-title">RAG</h2>
          <div class="top-actions">
            <button class="icon-btn" onclick="resetRagChat()" title="Clear">ğŸ”„</button>
          </div>
        </header>

        <!-- Status bar -->
        <div class="status-bar">
          <span id="rag-status-text" class="status-text">Load documents to start</span>
        </div>

        <!-- Document area -->
        <div class="rag-docs-area">
          <div class="section-subtitle">Knowledge Base</div>
          <div id="rag-docs-list" class="rag-docs-list">
            <div class="rag-empty">No documents loaded</div>
          </div>
          <button class="btn-secondary" onclick="document.getElementById('rag-file-input').click()">
            ğŸ“„ Load Document
          </button>
          <input type="file" id="rag-file-input" accept=".txt,.md" style="display: none" onchange="loadRagDocument(event)">
        </div>

        <!-- Messages area -->
        <div id="rag-messages" class="messages">
          <div class="empty-state">
            <div class="empty-icon">ğŸ“š</div>
            <div class="empty-title">Document Q&A</div>
            <div class="empty-sub">Upload a text file and ask questions about it</div>
          </div>
        </div>

        <!-- Input bar -->
        <div class="input-bar">
          <textarea id="rag-input" class="prompt-input" placeholder="Ask about your documents..." rows="1" disabled></textarea>
          <button id="rag-send-btn" class="send-btn" onclick="sendRagMessage()" disabled>â†‘</button>
        </div>
      </div>

      <!-- Vision Tab -->
      <div id="tab-vision" class="tab-panel">
        <header class="top-bar">
          <h2 class="top-title">Vision</h2>
          <div class="top-actions">
            <button id="vision-camera-btn" class="icon-btn" onclick="toggleCamera()" title="Toggle Camera">ğŸ“·</button>
          </div>
        </header>
        <div class="vision-container">
          <video id="camera-preview" class="camera-preview" autoplay playsinline muted></video>
          <canvas id="camera-canvas" class="camera-canvas hidden"></canvas>
          <div id="vision-overlay" class="vision-overlay">
            <div class="overlay-content">
              <div class="overlay-icon">ğŸ“·</div>
              <p id="vision-status">Camera vision requires WebGPU support</p>
              <button class="btn-secondary" onclick="toggleCamera()">Enable Camera</button>
            </div>
          </div>
          <div id="vision-description" class="vision-description hidden">
            <div id="vision-pulse" class="pulsing-dot"></div>
            <span id="vision-text"></span>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div id="tab-settings" class="tab-panel">
        <header class="top-bar"><h2 class="top-title">Settings</h2></header>
        <div class="settings-scroll">
          <!-- Device Status -->
          <div class="section-title">DEVICE STATUS</div>
          <div class="settings-card">
            <div class="info-row"><span class="row-icon">ğŸŒ</span><span class="row-label">Platform</span><span class="row-value">Web (Browser)</span></div>
            <div class="divider"></div>
            <div class="info-row"><span class="row-icon">ğŸ§ </span><span class="row-label">WebGPU</span><span id="webgpu-status" class="row-value">Checking...</span></div>
            <div class="divider"></div>
            <div class="info-row"><span class="row-icon">âš¡</span><span class="row-label">Backend</span><span class="row-value">WebAssembly</span></div>
          </div>

          <!-- Generation -->
          <div class="section-title">GENERATION</div>
          <div class="settings-card">
            <div class="slider-row">
              <span class="row-icon">ğŸŒ¡ï¸</span>
              <span class="row-label">Temperature</span>
              <span id="temp-value" class="slider-value">0.7</span>
            </div>
            <input type="range" id="temp-slider" class="slider" min="0" max="2" step="0.1" value="0.7" oninput="document.getElementById('temp-value').textContent=this.value">
            <div class="slider-hints"><span>Precise</span><span>Creative</span></div>
            <div class="divider"></div>
            <div class="slider-row">
              <span class="row-icon">ğŸ“</span>
              <span class="row-label">Max Tokens</span>
              <span id="tokens-value" class="slider-value">256</span>
            </div>
            <input type="range" id="tokens-slider" class="slider" min="32" max="1024" step="32" value="256" oninput="document.getElementById('tokens-value').textContent=this.value">
            <div class="slider-hints"><span>Short</span><span>Long</span></div>
          </div>

          <!-- Runtime Supervision -->
          <div class="section-title">RUNTIME SUPERVISION</div>
          <div class="settings-card">
            <div class="toggle-row">
              <span class="row-icon">ğŸ¯</span>
              <span class="row-label">Cloud Handoff</span>
              <label class="toggle-switch">
                <input type="checkbox" id="handoff-toggle" onchange="updateHandoffThreshold()">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="divider"></div>
            <div class="slider-row">
              <span class="row-icon">ğŸ“Š</span>
              <span class="row-label">Confidence Threshold</span>
              <span id="confidence-value" class="slider-value">0.7</span>
            </div>
            <input type="range" id="confidence-slider" class="slider" min="0.1" max="1.0" step="0.05" value="0.7" oninput="document.getElementById('confidence-value').textContent=this.value" disabled>
            <div class="slider-hints"><span>Strict</span><span>Lenient</span></div>
          </div>

          <!-- About -->
          <div class="section-title">ABOUT</div>
          <div class="settings-card">
            <div class="info-row"><span class="row-icon">âœ¨</span><span class="row-label">Veda</span><span class="row-value">1.1.0</span></div>
            <div class="divider"></div>
            <div class="info-row"><span class="row-icon">ğŸ’»</span><span class="row-label">Veda SDK</span><span class="row-value">1.1.0 (Web)</span></div>
            <div class="divider"></div>
            <div class="info-row"><span class="row-icon">ğŸ§ </span><span class="row-label">Backend</span><span class="row-value">WebAssembly</span></div>
            <div class="divider"></div>
            <div class="info-row" style="align-items:flex-start"><span class="row-icon">ğŸ›¡ï¸</span>
              <div><span class="row-label">Privacy</span><br><span class="row-sub">All inference runs locally in browser</span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom tabs -->
    <nav class="tab-bar">
      <button class="tab active" data-tab="chat" onclick="switchTab('chat')"><span class="tab-icon">ğŸ’¬</span><span class="tab-label">Chat</span></button>
      <button class="tab" data-tab="voice" onclick="switchTab('voice')"><span class="tab-icon">ğŸ¤</span><span class="tab-label">Voice</span></button>
      <button class="tab" data-tab="tools" onclick="switchTab('tools')"><span class="tab-icon">ğŸ”§</span><span class="tab-label">Tools</span></button>
      <button class="tab" data-tab="rag" onclick="switchTab('rag')"><span class="tab-icon">ğŸ“š</span><span class="tab-label">RAG</span></button>
      <button class="tab" data-tab="vision" onclick="switchTab('vision')"><span class="tab-icon">ğŸ“·</span><span class="tab-label">Vision</span></button>
      <button class="tab" data-tab="settings" onclick="switchTab('settings')"><span class="tab-icon">âš™ï¸</span><span class="tab-label">Settings</span></button>
    </nav>
  </div>

  <!-- Model selection modal -->
  <div id="model-modal" class="modal hidden" onclick="hideModelSheet()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-handle"></div>
      <div class="modal-title-row">
        <h3 class="modal-title">Models</h3>
        <button class="icon-btn" onclick="hideModelSheet()">âœ•</button>
      </div>
      <div class="device-card">
        <div class="device-icon">ğŸŒ</div>
        <div>
          <div class="device-name">Web Browser</div>
          <div class="device-meta" id="device-meta-text">WebAssembly â€¢ Checking WebGPU...</div>
        </div>
      </div>
      <div class="modal-section-title">AVAILABLE MODELS</div>
      <div id="model-list"></div>
    </div>
  </div>

  <!-- Benchmark modal -->
  <div id="benchmark-modal" class="modal hidden" onclick="hideBenchmarkModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-handle"></div>
      <div class="modal-title-row">
        <h3 class="modal-title">Benchmark</h3>
        <button class="icon-btn" onclick="hideBenchmarkModal()">âœ•</button>
      </div>
      <div class="benchmark-content">
        <div id="benchmark-progress" class="benchmark-progress hidden">
          <div class="progress-text">Running benchmark... <span id="benchmark-run">0/10</span></div>
          <div class="progress-bar-bg"><div id="benchmark-bar" class="progress-bar-fill"></div></div>
        </div>
        <div id="benchmark-results" class="benchmark-results hidden">
          <div class="result-row"><span>Average TTFT</span><span id="result-ttft">-</span></div>
          <div class="result-row"><span>Average Speed</span><span id="result-speed">-</span></div>
          <div class="result-row"><span>Average Tokens</span><span id="result-tokens">-</span></div>
        </div>
        <button id="run-benchmark-btn" class="btn-primary-modal" onclick="startBenchmark()">Run 10 Iterations</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>